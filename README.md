# Задание на стажировку в Infotecs

Формулировку и детали задания можно посмотреть в pdf файле в директории `Docs`.

## Запуск проекта

1. Клонируйте репозиторий и перейдите в проект

```bash
    git clone https://github.com/topoff0/infotecs-entry-task
    cd infotecs-entry-task
```

2.  В корне проекта создайте файл `.env` и скопируйте в него содержимое из `.env.example`.

3.  Запустите проект с помощью команды:

        ```bash
        docker compose up --build -d
        ```

    После запуска API будет доступен по адресу: [http://localhost:8080](http://localhost:8080), где также будет доступна документация Swagger.

---

## Тестирование

Для запуска всех тестов (Unit + Integration) выполните команду из корня проекта:

```bash
    dotnet test
```

В дополнении к этому в проекте также настроен CI для веток: `main`, `release`, `dev`.

---

## Требования

Для запуска и работы проекта необходимо:

- **.NET SDK 9.0.100** или выше — [скачать](https://dotnet.microsoft.com/download/dotnet/9.0)
- **Docker** и **Docker Compose** — [установка](https://docs.docker.com/get-docker/)

---

## Описание проекта

Решение `Application.sln` было разбито на 5 проектов:

```
├── Application.Api
├── Application.Core
├── Application.Data
├── Application.Services
└── Application.Shared
```

- **Application.Api**

  Веб-API проект для взаимодействия с приложением. Здесь находятся контроллеры,
  _middlewares_ и подключение основных конфигураций.

- **Application.Core**

  Основная бизнес-логика приложения. Здесь описываются доменные модели, интерфейсы и правила, которые реализуют бизнес-процессы.

- **Application.Data**

  Слой доступа к данным. Содержит репозитории, Entity Framework Core модели и миграции для работы с базой данных.

- **Application.Services**

  Основные сервисы, которые используются в API. Содержат основную бизнес-логику и реализацию решаемых задач.

- **Application.Shared**

  Общие модели, утилиты и константы, которые используются в нескольких проектах для избежания дублирования кода и быстрого внесения изменений в логику проекта.

---

## Принятые решения

1. **Application.Api**

- Папка `Dtos` с файлом `CsvFileRequest` была создана для решения проблемы со Swagger. Проблема заключалась в неспособности Swagger обрабатывать напрямую `IFormFile` в методе контроллера, из-за чего вылетал Exception.

- Для обработки ожидаемых и непредвиденных ошибок был создан стандартный _ExceptionMiddleware_, который оборачивает "все приложение" в `try-catch`. Обрабатывает кастомные ошибки, при неожиданных ошибках логирует место и описание ошибки, возвращает _Internal Server Error_. (Конечно Logger можно улучшить, добавив несколько провайдеров логирования).

2. **Application.Services**

- При рефакторинге была сильно изменена логика, дабы удовлетворять основным принципам SOLID. В связи с чем было создано множество новых классов и интерфейсов, отвечающих за отдельные зоны ответственности. Это позволило сделать код более модульным и расширяемым в будущем.

---

## Что можно улучшить

1. Добавить поддержку идемпотентности. (В данный момент не протестирована ситуация, когда два одинаковых запроса отправляются одновременно. Это, вероятно, приведёт к возникновению race condition и выполнению лишних операций.)

2. Покрыть тестами каждую реализацию _CustomValidationException_, проверяя все возможные сценарии, особенно в контексте CI.

3. Добавить различные провайдеры логирования: БД, консоль, файл, кеш.
